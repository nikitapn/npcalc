PRAGMA foreign_keys = ON;
BEGIN TRANSACTION;

-- Users
CREATE TABLE IF NOT EXISTS User (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  pwd BLOB, -- sha 256
  email TEXT NOT NULL UNIQUE
);

-- User sessions
CREATE TABLE IF NOT EXISTS UserSession (
  sessionId TEXT PRIMARY KEY, -- uuid
  userId INTEGER NOT NULL,
  FOREIGN KEY (userId) REFERENCES User (id)
);

-- Calculations
CREATE TABLE IF NOT EXISTS Calculation (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  userId INTEGER NOT NULL,
  name TEXT NOT NULL,
  elements TEXT, -- json array of arrays [[number,number,number],...]
  fertilizersIds TEXT, -- json array [number,...]
  volume REAL NOT NULL,
  mode BOOLEAN NOT NULL,
  FOREIGN KEY (userId) REFERENCES User (id)
);

CREATE INDEX IF NOT EXISTS UserId on Calculation (userId);

-- Solutions
CREATE TABLE IF NOT EXISTS Solution (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  userId INTEGER NOT NULL,
  name TEXT NOT NULL,
  NO3 REAL,
  NH4 REAL,
  P REAL,
  K REAL,
  Ca REAL,
  Mg REAL,
  S REAL,
  Cl REAL,
  Fe REAL,
  Zn REAL,
  B REAL,
  Mn REAL,
  Cu REAL,
  Mo REAL,
  FOREIGN KEY (userId) REFERENCES User (id)
);

CREATE INDEX IF NOT EXISTS UserId on Solution (userId);

-- Fertilizers
CREATE TABLE IF NOT EXISTS Fertilizer (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  userId INTEGER NOT NULL,
  name TEXT NOT NULL,
  formula TEXT,
  FOREIGN KEY (userId) REFERENCES User (id)
);

INSERT INTO User (id, name, pwd, email) VALUES
  (1, 'superuser', x'03AC674216F3E15C761EE1A5E255F067953623C8B388B4459E13F978D7C846F4', 'superuser@nscalc.com'),
  (2, 'guest', x'03AC674216F3E15C761EE1A5E255F067953623C8B388B4459E13F978D7C846F4', 'guest@nscalc.com')
  ;

INSERT INTO Solution (id, userId, name, NO3, NH4, P, K, Ca, Mg, S, Cl, Fe, Zn, B, Mn, Cu, Mo) VALUES
  (121,1,'Basil - Booklet - IS',235.000000,18.000000,39.000000,264.000000,180.000000,73.000000,80.000000,0.000000,1.400000,0.327000,0.378000,0.550000,0.064000,0.048000),
  (122,1,'Basil - Booklet - OM',169.000000,17.000000,34.000000,239.000000,132.000000,21.000000,38.000000,0.000000,1.120000,0.196000,0.108000,0.275000,0.032000,0.048000),
  (156,1,'Cucumber - Booklet - IS - #0 Standart',224.000000,18.000000,39.000000,313.000000,160.000000,33.000000,44.000000,0.000000,0.840000,0.327000,0.270000,0.550000,0.048000,0.048000),
  (124,1,'Cucumber - Booklet - IS - #1 Start',224.000000,11.000000,39.000000,274.000000,180.000000,39.000000,44.000000,0.000000,2.000000,0.327000,0.378000,0.550000,0.048000,0.048000),
  (125,1,'Cucumber - Booklet - IS - #2 Fruit set',238.000000,18.000000,39.000000,352.000000,160.000000,33.000000,44.000000,0.000000,0.840000,0.327000,0.270000,0.550000,0.048000,0.048000),
  (126,1,'Cucumber - Booklet - IS - #3 High water',224.000000,18.000000,39.000000,274.000000,180.000000,33.000000,44.000000,0.000000,0.840000,0.327000,0.270000,0.550000,0.048000,0.048000),
  (127,1,'Cucumber - Booklet - IS - #4 End season',224.000000,4.000000,8.000000,313.000000,160.000000,33.000000,44.000000,0.000000,0.840000,0.327000,0.270000,0.550000,0.048000,0.048000),
  (166,1,'Cucumber - Booklet - Soil',111.000000,13.000000,16.000000,137.000000,80.000000,24.000000,32.000000,0.000000,0.280000,0.065000,0.108000,0.110000,0.019000,0.000000),
  (82,1,'Cucumber - Galuku - CC - #0 (weeks 0-3)',212.000000,9.000000,35.000000,268.000000,169.000000,31.000000,54.000000,15.000000,1.120000,0.200000,0.330000,0.600000,0.050000,0.040000),
  (83,1,'Cucumber - Galuku - CC - #1 (weeks 3-5)',238.000000,9.000000,39.000000,307.000000,179.000000,34.000000,56.000000,0.000000,1.120000,0.200000,0.330000,0.600000,0.050000,0.040000),
  (84,1,'Cucumber - Galuku - CC - #2 (weeks 5-12)',238.000000,9.000000,39.000000,338.000000,169.000000,36.000000,55.000000,0.000000,1.120000,0.200000,0.330000,0.650000,0.050000,0.040000),
  (85,1,'Cucumber - Galuku - CC - #3 (from week 12)',232.000000,9.000000,37.000000,311.000000,169.000000,34.000000,45.000000,0.000000,1.120000,0.200000,0.330000,0.650000,0.050000,0.040000),
  (95,1,'Cucumber - RW - #1 (saturation)',234.610000,17.510000,38.720000,263.910000,180.350000,72.920000,80.160000,0.000000,0.840000,0.330000,0.270000,0.550000,0.050000,0.050000),
  (97,1,'Cucumber - RW - #2 (saturation roockwool slabs)',217.800000,15.410000,38.720000,226.770000,220.430000,48.610000,81.770000,0.000000,1.120000,0.260000,0.320000,0.550000,0.030000,0.050000),
  (98,1,'Cucumber - RW - #3 (start)',308.150000,21.010000,60.400000,304.970000,240.470000,54.690000,29.660000,0.000000,0.840000,0.330000,0.270000,0.550000,0.050000,0.050000),
  (99,1,'Cucumber - RW - #4 (standart)',219.210000,14.010000,43.360000,295.190000,212.410000,54.690000,105.810000,0.000000,0.840000,0.330000,0.270000,0.550000,0.050000,0.050000),
  (100,1,'Cucumber - RW - #5 (generative phase)',199.600000,14.010000,38.720000,332.340000,200.390000,54.690000,136.280000,0.000000,0.840000,0.330000,0.270000,0.550000,0.050000,0.050000),
  (173,1,'Dill',224.000000,16.000000,44.000000,262.000000,216.000000,47.000000,82.000000,0.000000,0.840000,0.327000,0.324000,0.550000,0.050000,0.050000),
  (128,1,'Lettuce - Booklet - IS',224.000000,14.000000,47.000000,371.000000,180.000000,24.000000,64.000000,0.000000,2.224000,0.458000,0.432000,0.385000,0.064000,0.096000),
  (81,1,'Lettuce - Cornell - IS',120.000000,5.000000,31.000000,215.000000,84.000000,24.000000,35.000000,0.000000,0.940000,0.130000,0.160000,0.140000,0.030000,0.030000),
  (165,1,'Loquat',221.000000,6.880000,41.173000,285.480000,189.710000,60.663000,80.383000,4.740000,2.000000,0.327000,0.387800,0.550000,0.048000,0.048000),
  (91,1,'Melon - Booklet - IS - #0 Start ',224.000000,4.000000,39.000000,274.000000,180.000000,46.000000,45.000000,0.000000,1.400000,0.327000,0.378000,0.550000,0.048000,0.048000),
  (92,1,'Melon - Booklet - IS - #1 Fruit set',224.000000,18.000000,39.000000,352.000000,140.000000,34.000000,45.000000,0.000000,1.840000,0.327000,0.270000,0.550000,0.048000,0.048000),
  (117,1,'Melon - Booklet - IS - #2 High water',224.000000,18.000000,39.000000,274.000000,180.000000,34.000000,45.000000,0.000000,1.840000,0.327000,0.270000,0.550000,0.048000,0.048000),
  (145,1,'Spathiphyllum - Sonneveld #1 - Vegetative',197.490000,19.610000,46.460000,285.420000,160.310000,30.380000,57.720000,0.000000,0.840000,0.330000,0.270000,0.550000,0.050000,0.050000),
  (146,1,'Spathiphyllum - Sonneveld #2 - Generative',126.060000,14.010000,30.970000,234.590000,100.200000,24.310000,64.130000,0.000000,0.840000,0.330000,0.270000,0.550000,0.050000,0.050000),
  (175,1,'Strawberry - Booklet - IS - #0 Standart',168.000000,14.000000,31.000000,188.000000,144.000000,36.000000,48.000000,0.000000,1.680000,0.458000,0.216000,0.550000,0.048000,0.048000),
  (176,1,'Strawberry - Booklet - IS - #0 Standart - Root Zone',168.000000,14.000000,31.000000,196.000000,180.000000,49.000000,96.700000,0.000000,1.680000,0.458000,0.216000,0.550000,0.048000,0.048000),
  (174,1,'Strawberry - Booklet - IS - #1 Start',193.000000,14.000000,39.000000,188.000000,184.000000,36.000000,48.000000,0.000000,2.240000,0.458000,0.216000,0.825000,0.048000,0.048000),
  (177,1,'Strawberry - Booklet - IS - #2 Generative - Root Zone',175.000000,0.000000,31.000000,274.000000,180.000000,49.000000,105.000000,0.000000,2.000000,0.458000,0.200000,0.550000,0.048000,0.048000),
  (167,1,'Tomato - Booklet - IS - #0 Standart',210.000000,17.000000,47.000000,371.000000,216.000000,58.000000,141.000000,35.000000,0.840000,0.327000,0.432000,0.550000,0.048000,0.048000),
  (106,1,'Tomato - Booklet - IS - #1 Start',210.000000,3.000000,47.000000,332.000000,236.000000,70.000000,141.000000,35.000000,1.400000,0.327000,0.432000,0.550000,0.048000,0.048000),
  (107,1,'Tomato - Booklet - IS - #2 Fruit set',210.000000,17.000000,47.000000,430.000000,196.000000,52.000000,141.000000,35.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (109,1,'Tomato - Booklet - IS - #3 High water',210.000000,17.000000,47.000000,332.000000,236.000000,58.000000,141.000000,35.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (111,1,'Tomato - Booklet - IS - #4 End season',210.000000,3.000000,16.000000,371.000000,216.000000,58.000000,141.000000,35.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (86,1,'Tomato - Galuku - CC - #0 (saturation)',186.000000,8.000000,49.000000,298.000000,197.000000,65.000000,140.000000,122.000000,1.050000,0.320000,0.370000,0.580000,0.060000,0.050000),
  (87,1,'Tomato - Galuku - CC - #1 (weeks 0-5)',173.000000,8.000000,41.000000,300.000000,197.000000,50.000000,117.000000,122.000000,1.050000,0.320000,0.330000,0.580000,0.060000,0.050000),
  (88,1,'Tomato - Galuku - CC - #2 (weeks 5-8)',171.000000,7.000000,41.000000,322.000000,188.000000,52.000000,120.000000,122.000000,1.050000,0.320000,0.330000,0.580000,0.060000,0.050000),
  (89,1,'Tomato - Galuku - CC - #3 (standart)',169.000000,4.000000,43.000000,356.000000,179.000000,55.000000,126.000000,122.000000,1.050000,0.320000,0.330000,0.580000,0.060000,0.050000),
  (152,1,'Tomato - SQM - RW - #0 saturation roockwool slabs',224.000000,0.000000,31.000000,222.000000,276.000000,83.000000,145.000000,10.000000,0.840000,0.327000,0.430000,0.550000,0.048000,0.048000),
  (138,1,'Tomato - SQM - RW - #1 from planting to flowering 1st cluster',238.000000,17.000000,47.000000,332.000000,236.000000,70.000000,136.000000,10.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (139,1,'Tomato - SQM - RW - #2 from flowering first flower 1st cluster',224.000000,17.000000,47.000000,371.000000,216.000000,58.000000,136.000000,10.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (140,1,'Tomato - SQM - RW - #3 from flowering first flower 3rd cluster',224.000000,17.000000,47.000000,390.000000,211.000000,55.000000,136.000000,10.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (153,1,'Tomato - SQM - RW - #4 from flowering first flower 5th cluster',224.000000,17.000000,47.000000,443.000000,191.000000,52.000000,128.000000,30.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (154,1,'Tomato - SQM - RW - #5 from flowering first flower 10th cluster',224.000000,17.000000,47.000000,390.000000,211.000000,55.000000,136.000000,10.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000),
  (155,1,'Tomato - SQM - RW - #6 from flowering first flower 12th cluster',224.000000,17.000000,47.000000,371.000000,216.000000,58.000000,136.000000,10.000000,0.840000,0.327000,0.324000,0.550000,0.048000,0.048000)
  ;

INSERT INTO Fertilizer (id, userId, name, formula) VALUES
(25,1,'Ammonium nitrate','bottle := A;
formula NH4NO3 purity 99.8;'),
(26,1,'Ammonium sulfate','bottle := B;
formula (NH4)2SO4 purity 99.8;'),
(22,1,'Calcium nitrate','formula Ca(NO3)2 * 4H2O purity 99.8;'),
(31,1,'Calcium nitrate - double salt','formula 5Ca(NO3)2 * NH4NO3 * 10H2O purity 99.8;'),
(19,1,'Diammonium phosphate','formula (NH4)2HPO4 purity 99.8;'),
(30,1,'Magnesium nitrate','bottle := B;
formula Mg(NO3)2 * 6H2O purity 99.8;'),
(23,1,'Magnesium sulfate','bottle := B;
formula MgSO4 * 7H2O purity 99.8;'),
(38,1,'MasterBlend 4-18-38 Tomato','N-NH4 := 0.5;
N-NO3 := 3.5;
formula P2O5 purity 18;
formula K2O purity 38;
Mg := 0.5;
B := 0.2;
S := 6.1;'),
(20,1,'Monoammonium phosphate','cost := 215;
bottle := B;
formula (NH4)H2PO4 purity 99.8;'),
(24,1,'Monopotassium phosphate','bottle := B;
formula KH2PO4 purity 99.8;'),
(21,1,'Potassium nitrate','bottle := B;
formula KNO3 purity 99.8;'),
(27,1,'Potassium sulfate','bottle := B;
formula K2SO4 purity 99.8;')
  ;

INSERT INTO Calculation (userId, name, elements, fertilizersIds, volume, mode) VALUES
  (2,'Dill','[[218.000000,218.000000,0.500000],[11.000000,11.000000,0.500000],[44.000000,44.000000,0.500000],[262.000000,262.000000,0.500000],[216.000000,216.000000,0.500000],[47.000000,47.000000,0.500000],[82.000000,82.000000,0.500000],[0.000000,0.000000,0.500000],[1.400000,1.400000,0.500000],[0.327000,0.327000,0.500000],[0.324000,0.324000,0.500000],[0.550000,0.550000,0.500000],[0.050000,0.050000,0.500000],[0.050000,0.050000,0.500000]]','[25,22,23,24,21,27]',100,0),
  (2,'Cucumber - Booklet - IS - #0 Standart','[[224.000000,224.000000,0.500000],[18.000000,18.000000,0.500000],[39.000000,39.000000,0.500000],[313.000000,313.000000,0.500000],[160.000000,160.000000,0.500000],[33.000000,33.000000,0.500000],[44.000000,44.000000,0.500000],[0.000000,0.000000,0.500000],[0.840000,0.840000,0.500000],[0.327000,0.327000,0.500000],[0.270000,0.270000,0.500000],[0.550000,0.550000,0.500000],[0.048000,0.048000,0.500000],[0.048000,0.048000,0.500000]]','[31,23,20,24,21]',100,0),
  (2,'Basil - Booklet - IS','[[235.000000,235.000000,0.500000],[18.000000,18.000000,0.500000],[39.000000,39.000000,0.500000],[264.000000,264.000000,0.500000],[180.000000,180.000000,0.500000],[73.000000,73.000000,0.500000],[80.000000,80.000000,0.500000],[0.000000,0.000000,0.500000],[1.400000,1.400000,0.500000],[0.327000,0.327000,0.500000],[0.378000,0.378000,0.500000],[0.550000,0.550000,0.500000],[0.064000,0.064000,0.500000],[0.048000,0.048000,0.500000]]','[25,31,30,24,21,27]',100,0)
  ;

COMMIT;